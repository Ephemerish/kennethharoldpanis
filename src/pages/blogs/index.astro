---
import MainLayout from "../../layouts/MainLayout.astro";
import Card from "../../components/Card.astro";
import SearchForm from "../../components/SearchForm.astro";
import Pagination from "../../components/Pagination.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { BLOGS_PER_PAGE } from "../../constants";

const currentPage: number | null = +Astro.url.searchParams.get("page")! || 1;

const allBlogs: CollectionEntry<"blog">[] = (
  await getCollection("blog")
).sort(
  (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
    b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const totalPages: number = Math.ceil(
  allBlogs.length / BLOGS_PER_PAGE
);

const blogsForPage: CollectionEntry<"blog">[] = allBlogs.slice(
  (currentPage - 1) * BLOGS_PER_PAGE,
  currentPage * BLOGS_PER_PAGE
);
---

<MainLayout 
  title="Blog - Kenneth Harold Panis"
  description="Read my thoughts on technology, development, IoT projects, and engineering insights. Sharing knowledge and experiences from my journey as a developer."
  image="/me.jpg"
  type="website"
>
  <div class="min-h-screen bg-hero-gradient relative overflow-hidden">
    <!-- Decorative background elements -->
    <div class="absolute inset-0">
      <div class="absolute top-0 left-0 w-96 h-96 bg-brand-100/20 rounded-full blur-3xl transform -translate-x-1/3 -translate-y-1/3"></div>
      <div class="absolute bottom-0 right-0 w-96 h-96 bg-brand-50/30 rounded-full blur-3xl transform translate-x-1/3 translate-y-1/3"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16 relative">
      <!-- Header Section with Enhanced Design -->
      <div class="text-center mb-16 sm:mb-20 animate-fade-in">
        <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-6">
          <span class="text-neutral-900">My</span> <span class="text-brand-gradient">Blog</span>
        </h1>
        <p class="text-xl sm:text-2xl text-neutral-700 max-w-4xl mx-auto leading-relaxed px-2 mb-8">
          Thoughts, tutorials, and insights from my journey in technology and development.
        </p>
        <div class="w-32 h-1 bg-brand-gradient mx-auto rounded-full"></div>
      </div>

      <!-- Blogs Grid with Enhanced Styling -->
      <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-8 sm:gap-10">
        {blogsForPage.map((blog, index) => (
          <div class="hover-lift animate-fade-in" style={`animation-delay: ${index * 0.1}s`}>
            <Card item={blog} type="blog" />
          </div>
        ))}
      </div>

    <!-- Empty State -->
    {allBlogs.length === 0 && (
      <div class="text-center py-12 sm:py-16 px-4">
        <div class="text-neutral-600 mb-4">
          <svg class="w-12 h-12 sm:w-16 sm:h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
        </div>
        <h3 class="text-lg sm:text-xl font-medium text-neutral-900 mb-2">No blog posts yet</h3>
        <p class="text-neutral-600 text-sm sm:text-base">Check back soon for new content!</p>
      </div>
    )}

    <!-- Pagination -->
    {totalPages > 1 && (
      <div class="mt-12 sm:mt-16">
        <Pagination
          currentPage={currentPage}
          totalPages={totalPages}
          disablePrevious={currentPage === 1}
          disableNext={currentPage === totalPages}
        />
      </div>
    )}
  </div>
</MainLayout>
